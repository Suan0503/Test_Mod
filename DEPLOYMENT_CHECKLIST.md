# 📋 Test_Mod 販售版部署檢查清單

## ✅ 部署前準備

### 1. 環境變數設定
- [ ] `DATABASE_URL` - 資料庫連線 URL
- [ ] `CHANNEL_ACCESS_TOKEN` - LINE Bot Channel Access Token
- [ ] `CHANNEL_SECRET` - LINE Bot Channel Secret
- [ ] `SECRET_KEY` - Flask 密鑰
- [ ] `LINE_NOTIFY_TOKEN` - LINE Notify Token（如需使用）

### 2. 資料庫設定
- [ ] 確認資料庫連線正常
- [ ] 執行所有 migration
  ```bash
  flask db upgrade
  ```
- [ ] 驗證資料表建立成功
  - `group_feature_setting`
  - `command_config`
  - `feature_usage_log`
  - 其他既有資料表

### 3. 管理員設定
- [ ] 在 `storage.py` 設定 `ADMIN_IDS`
  ```python
  ADMIN_IDS = {
      'U5ce6c382...',  # 主管理員
      'U2bcd6300...',  # 副管理員
  }
  ```

### 4. 初始化指令配置
- [ ] 執行初始化腳本
  ```python
  from utils.feature_control import init_command_config
  init_command_config()
  ```
- [ ] 確認 `command_config` 表有資料

## 🔧 功能檢查

### 基礎功能
- [ ] LINE Bot Webhook 正常接收訊息
- [ ] 驗證資訊查詢正常
- [ ] 回報文功能正常
- [ ] 每日抽獎功能正常
- [ ] 錢包查詢功能正常

### 功能控制系統
- [ ] `/功能設定` - 查看功能狀態
- [ ] `/設定功能 <功能>` - 切換功能開關
- [ ] `/設定方案 <方案>` - 套用功能方案
- [ ] `/生成token` - 生成群組 TOKEN
- [ ] 功能檢查正確攔截未授權操作

### 管理功能
- [ ] 管理面板入口正常
- [ ] 手動驗證功能正常
- [ ] 預約系統功能正常
- [ ] 薪資管理功能正常
- [ ] 統計功能正常

## 📊 測試場景

### 場景 1：新群組加入
1. [ ] 機器人加入測試群組
2. [ ] 預設狀態為全功能開啟
3. [ ] 執行 `/功能設定` 確認狀態
4. [ ] 測試各項功能可正常使用

### 場景 2：方案設定
1. [ ] 執行 `/設定方案 basic`
2. [ ] 確認只有基礎功能可用
3. [ ] 測試未授權功能被正確攔截
4. [ ] 升級到 `/設定方案 professional`
5. [ ] 確認新功能可以使用

### 場景 3：個別功能控制
1. [ ] 執行 `/設定功能 draw` 關閉抽獎
2. [ ] 測試「每日抽獎」被攔截
3. [ ] 再次執行 `/設定功能 draw` 開啟
4. [ ] 確認抽獎功能恢復正常

### 場景 4：TOKEN 管理
1. [ ] 執行 `/生成token`
2. [ ] 記錄生成的 TOKEN
3. [ ] 再次生成，確認 TOKEN 更新

## 🔐 安全檢查

- [ ] 管理指令只有 ADMIN_IDS 可執行
- [ ] 群組 TOKEN 不會洩露給一般用戶
- [ ] 資料庫密碼安全儲存
- [ ] API 端點有適當的驗證機制
- [ ] 敏感資訊不在日誌中顯示

## 📝 文件檢查

- [ ] `FEATURE_CONTROL_GUIDE.md` - 功能控制指南
- [ ] `DEPLOYMENT_CHECKLIST.md` - 本檢查清單
- [ ] `CONFIGURATION_EXAMPLES.md` - 配置範例
- [ ] `CHANGELOG.md` - 更新日誌
- [ ] `README.md` - 專案說明

## 🚀 上線前最終確認

### 程式碼檢查
- [ ] 移除所有測試用的 print 語句
- [ ] 確認錯誤處理機制完整
- [ ] 檢查日誌記錄設定
- [ ] 確認所有 TODO 註解已處理

### 效能檢查
- [ ] 資料庫查詢已優化（索引、批次查詢）
- [ ] 資料庫連接池設定適當
- [ ] 記憶體使用在合理範圍
- [ ] 回應時間符合預期

### 備份機制
- [ ] 設定資料庫自動備份
- [ ] 確認備份恢復流程可行
- [ ] 重要設定檔已備份
- [ ] 文件記錄備份位置

## 📞 監控與維護

### 監控項目
- [ ] 設定錯誤通知（Sentry 或類似服務）
- [ ] 設定資源使用監控
- [ ] 設定資料庫效能監控
- [ ] 設定 Webhook 連線監控

### 維護計畫
- [ ] 定期檢查功能使用統計
- [ ] 定期清理過期的日誌資料
- [ ] 定期更新依賴套件
- [ ] 定期檢查資料庫效能

## 🎯 客戶交付清單

### 文件交付
- [ ] 功能使用手冊（管理員版）
- [ ] 指令快速參考卡
- [ ] 常見問題 FAQ
- [ ] 故障排除指南

### 培訓項目
- [ ] 管理指令使用教學
- [ ] 功能方案設定教學
- [ ] 異常處理教學
- [ ] 日常維護教學

### 後續支援
- [ ] 技術支援聯絡方式
- [ ] 緊急故障處理流程
- [ ] 功能更新通知機制
- [ ] 定期維護服務說明

## ✨ 選用進階功能

### 授權管理
- [ ] 實作授權到期檢查
- [ ] 實作自動續約提醒
- [ ] 實作授權驗證 API
- [ ] 實作多層級授權

### 統計分析
- [ ] 實作每日使用統計
- [ ] 實作功能熱度分析
- [ ] 實作用戶活躍度分析
- [ ] 匯出統計報表功能

### 自動化
- [ ] 自動清理過期記錄
- [ ] 自動備份資料庫
- [ ] 自動健康檢查
- [ ] 自動效能優化

---

**檢查日期**: ___________  
**檢查人員**: ___________  
**環境**: □ 開發 □ 測試 □ 正式  
**版本**: v2.0 販售版

**備註**:
```
請在部署時逐項確認，並在完成的項目打勾。
遇到問題時請記錄在備註欄，以便追蹤處理。
```
