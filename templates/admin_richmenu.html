<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>RichMenu ç®¡ç†</title>
<style>
 body{font-family:'Zen Maru Gothic','å¾®è»Ÿæ­£é»‘é«”',sans-serif;background:#f5f7fa;margin:0;color:#333}
 a.button, button{background:#1976d2;color:#fff;border:none;border-radius:6px;padding:6px 12px;text-decoration:none;cursor:pointer;font-size:.85rem}
 table{width:100%;border-collapse:collapse;margin-top:12px}
 th,td{border-bottom:1px solid #e0e0e0;padding:6px 8px;text-align:left;font-size:.8rem}
 thead tr{background:#1565c0;color:#fff}
 .card{background:#fff;padding:14px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.08);margin-bottom:18px}
 .flex{display:flex;gap:12px;flex-wrap:wrap}
 input,select{padding:6px 8px;border:1px solid #cfd8dc;border-radius:6px;font-size:.8rem}
 .danger{background:#e53935}
 .warn{background:#fb8c00}
 .pill{background:#e3f2fd;color:#0d47a1;border-radius:999px;padding:4px 10px;font-size:.7rem;margin-right:6px}
</style>
</head>
<body>
 <div style="padding:16px;background:#e3f2fd;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap">
   <h2 style="margin:0">ğŸ§© RichMenu ç®¡ç†</h2>
   <div class="flex">
     <a class="button" href="/admin/home">å›å¾Œå°ä¸»é </a>
     <a class="button" href="/admin/richmenu">é‡æ–°æ•´ç†</a>
   </div>
 </div>
 <div style="max-width:1200px;margin:20px auto;padding:0 18px">
   <div class="card">
     <h3 style="margin:4px 0">æœå°‹ / å¿«å–</h3>
     <form method="get" action="/admin/richmenu" style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px">
       <input type="text" name="q" placeholder="æœå°‹ user_id æˆ– state" value="{{ q }}" style="flex:1;min-width:200px" />
       <button type="submit">æœå°‹</button>
       {% if q %}<a class="button" href="/admin/richmenu" style="background:#78909c">æ¸…é™¤</a>{% endif %}
     </form>
     <form method="post" action="/admin/richmenu" onsubmit="return confirm('æ¸…é™¤å¿«å–ä¸¦é‡æ–°å»ºç«‹ / é©—è­‰ RichMenuï¼Ÿ')">
       <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
       <input type="hidden" name="action" value="clear_cache" />
       <button type="submit" class="warn">æ¸…é™¤å¿«å– / é‡æ–°è¼‰å…¥</button>
     </form>
   </div>
   <div class="card">
  <h3 style="margin:4px 0">ç¾æœ‰ RichMenu</h3>
     <table>
       <thead><tr><th>State</th><th>RichMenu ID</th><th>æ“ä½œ</th></tr></thead>
       <tbody>
         {% for s,id in menus.items() %}
         <tr>
           <td>{{ s }}</td>
           <td style="font-family:monospace">{{ id }}</td>
           <td>
             <form method="post" action="/admin/richmenu" style="display:inline-block;margin:0" enctype="multipart/form-data">
               <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
               <input type="hidden" name="state" value="{{ s }}" />
               <input type="hidden" name="action" value="upload_image" />
               <input type="file" name="image" accept="image/png,image/jpeg" required />
               <button type="submit">æ›åœ–</button>
             </form>
             <form method="post" action="/admin/richmenu" style="display:inline-block;margin:0">
               <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
               <input type="hidden" name="state" value="{{ s }}" />
               <input type="hidden" name="action" value="recreate" />
               <button type="submit" class="warn" onclick="return confirm('é‡å»ºæœƒç”¢ç”Ÿæ–° IDï¼Œç¢ºå®šï¼Ÿ')">é‡å»º</button>
             </form>
             <form method="post" action="/admin/richmenu" style="display:inline-block;margin:0">
               <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
               <input type="hidden" name="state" value="{{ s }}" />
               <input type="hidden" name="action" value="delete" />
               <button type="submit" class="danger" onclick="return confirm('åˆªé™¤å¾Œéœ€é‡å»ºï¼Œç¢ºå®šï¼Ÿ')">åˆªé™¤</button>
             </form>
             <a class="button" href="{{ url_for('admin.admin_richmenu_image', state=s) }}" target="_blank" style="background:#455a64">æŸ¥çœ‹åœ–ç‰‡</a>
           </td>
         </tr>
         {% endfor %}
       </tbody>
     </table>
     <div style="margin-top:8px;font-size:.7rem;color:#555">æç¤ºï¼šé‡å»ºå¾Œéœ€é‡æ–°ä¸Šå‚³æ­£å¼åœ–ç‰‡ã€‚</div>
   </div>

   <div class="card">
     <h3 style="margin:4px 0">æ‰‹å‹•ç¶å®šä½¿ç”¨è€…</h3>
     <form method="post" action="/admin/richmenu" class="flex">
       <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
       <input type="hidden" name="action" value="link_user" />
       <input type="text" name="user_id" placeholder="LINE User ID" required style="min-width:240px" />
       <select name="state" required>
         {% for s in states %}
           <option value="{{ s }}">{{ s }}</option>
         {% endfor %}
       </select>
       <button type="submit">ç¶å®š</button>
     </form>
     <form method="post" action="/admin/richmenu" style="margin-top:10px">
       <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
       <input type="hidden" name="action" value="rebind_missing" />
       <button type="submit" onclick="return confirm('é‡æ–°ç¶å®šå¯èƒ½è¼ƒä¹…ï¼Œç¢ºå®šåŸ·è¡Œï¼Ÿ')">æ‰¹æ¬¡é‡æ–°ç¶å®šï¼ˆæœ€å¤š200ç­†ç·©å­˜ï¼‰</button>
     </form>
   </div>

   <div class="card">
     <h3 style="margin:4px 0">æœ€è¿‘ç¶å®šç´€éŒ„ï¼ˆæœ€å¤š200ç­†ï¼‰ {% if q %}<span style="font-size:.65rem;color:#1976d2">å·²å¥—ç”¨æœå°‹</span>{% endif %}</h3>
     <table>
       <thead><tr><th>ä½¿ç”¨è€…</th><th>State</th><th>RichMenu ID</th><th>æ›´æ–°æ™‚é–“</th></tr></thead>
       <tbody>
         {% for b in bindings %}
         <tr>
           <td style="font-family:monospace">{{ b.line_user_id }}</td>
           <td>{{ b.state }}</td>
           <td style="font-family:monospace">{{ b.rich_menu_id }}</td>
           <td>{{ b.updated_at.strftime('%Y-%m-%d %H:%M:%S') if b.updated_at else '' }}</td>
         </tr>
         {% endfor %}
       </tbody>
     </table>
   </div>
 </div>
</body>
</html>
