<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æ‰£æ¬¾å°å¸³</title>
  <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:'Zen Maru Gothic','å¾®è»Ÿæ­£é»‘é«”',sans-serif;background:#f7f9fb;margin:0;color:#333}
    .header{padding:20px;text-align:center;background:#ede7f6;box-shadow:0 2px 8px rgba(0,0,0,.06)}
    .header a{display:inline-block;margin:6px 8px;background:#673ab7;color:#fff;padding:8px 12px;border-radius:10px;text-decoration:none;font-size:.75rem}
    .container{max-width:1200px;margin:24px auto;padding:0 18px}
    .card{background:#fff;border-radius:12px;box-shadow:0 4px 16px rgba(0,0,0,.06);padding:16px;margin-bottom:16px}
    table{width:100%;border-collapse:collapse;font-size:.8rem}
    th,td{border-bottom:1px solid #e0e0e0;padding:6px 8px;text-align:left}
    thead tr{background:#512da8;color:#fff}
    tr:hover{background:#fafafa}
    .pill{background:#ede7f6;color:#311b92;border-radius:999px;padding:6px 10px;font-size:.7rem;display:inline-block;margin:4px 6px}
    input,select{padding:6px 8px;border:1px solid #cfd8dc;border-radius:8px;font-size:.75rem}
    button{background:#512da8;border:none;color:#fff;border-radius:8px;padding:6px 10px;cursor:pointer;font-size:.75rem}
  </style>
</head>
<body>
  <div class="header">
    <h2 style="margin:0">ğŸ’¸ æ‰£æ¬¾å°å¸³</h2>
    <a href="/admin/wallet">å„²å€¼é‡‘å°ˆå€</a>
    <a href="/admin/wallet/reconcile">å„²å€¼å°å¸³</a>
    <a href="/admin/wallet/summary">å„²å€¼è¨˜éŒ„</a>
  </div>
  <div class="container">
    <div class="card">
      <div>
        <span class="pill">æŸ¥è©¢å€é–“ï¼š{{ start_local_display }} ~ {{ end_local_display }}</span>
        <span class="pill">ä½¿ç”¨å„²å€¼é‡‘ï¼š{{ stored_sum }} å…ƒï¼ˆ{{ stored_count }} ç­†ï¼‰</span>
        <span class="pill" title="é‡‘é¡ç‚º 0 ä¸”ä½¿ç”¨æŠ˜åƒ¹åˆ¸">ä½¿ç”¨æŠ˜åƒ¹åˆ¸ï¼š{{ coupon_only_count }} ç­†</span>
      </div>
      <form method="get" action="/admin/wallet/reconcile/consume" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:10px">
        <label>å¿«é€Ÿå€é–“</label>
  <select name="preset" onchange="this.form.submit()">
          <option value="">è‡ªè¨‚</option>
          <option value="today" {% if preset=='today' %}selected{% endif %}>ä»Šæ—¥</option>
          <option value="yesterday" {% if preset=='yesterday' %}selected{% endif %}>æ˜¨æ—¥</option>
          <option value="thisweek" {% if preset=='thisweek' %}selected{% endif %}>æœ¬é€±</option>
          <option value="thismonth" {% if preset=='thismonth' %}selected{% endif %}>æœ¬æœˆ</option>
        </select>
  <label>èµ·</label>
  <input type="date" name="start" value="{{ start or '' }}" />
  <label>è¿„</label>
  <input type="date" name="end" value="{{ end or '' }}" />
        <label>å‚™è¨»é—œéµå­—</label>
        <input type="text" name="remark_kw" value="{{ remark_kw or '' }}" placeholder="è¼¸å…¥é—œéµå­—" />
        <button type="submit">æŸ¥è©¢</button>
      </form>
    </div>

    <div class="card">
      <h3 style="margin:0 0 6px">æ˜ç´°</h3>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>æ™‚é–“(å°åŒ—)</th>
            <th>æ‰‹æ©Ÿ</th>
            <th>åç¨±</th>
            <th>ç·¨è™Ÿ</th>
            <th>é‡‘é¡</th>
            <th>æŠ˜åƒ¹åˆ¸ä½¿ç”¨</th>
            <th>å‚™è¨»</th>
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
          <tr>
            <td>{{ r.id }}</td>
            <td>{{ r.time }}</td>
            <td>{% if r.phone and r.phone!='â€”' %}<a href="/admin/wallet?q={{ r.phone }}" style="color:#512da8;text-decoration:none">{{ r.phone }}</a>{% else %}â€”{% endif %}</td>
            <td>{{ r.nickname }}</td>
            <td>{{ r.code }}</td>
            <td>{{ r.amount }}</td>
            <td>{{ r.coupon_used }}</td>
            <td>{{ r.remark }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</body>
</html>
