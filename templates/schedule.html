{% extends 'admin_custom_master.html' %}
{% block body %}
<style>
  .schedule-table { border-collapse: collapse; width:100%; }
  .schedule-table th, .schedule-table td { border:1px solid #b6d6ff; padding:8px; text-align:center; }
  .schedule-table th { background:#e3f2fd; }
  .girl-name, .room-input { width:80px; display:block; margin:2px auto; }
  .lang-check { margin:0 4px; }
  .time-cell { display:flex; align-items:center; gap:4px; margin-right:8px; }
  .time-row { display:flex; flex-wrap:wrap; padding:4px; }
  .duration-row { display:flex; flex-wrap:wrap; padding:4px; gap:10px; }
</style>

<div class="schedule-main" style="display:flex;gap:32px;padding:32px 0;">
  <div style="flex:1;">
    <h3>æ’ç­è¡¨</h3>
    <table class="schedule-table" id="schedule-table">
      <thead>
        <tr>
          <th>å¦¹å¦¹<br><small>ï¼ˆåç¨±ï¼‹æˆ¿è™Ÿï¼‰</small></th>
          <th>èªè¨€</th>
          <th>åœ‹ç±</th>
          <th>æ™‚é–“</th>
        </tr>
      </thead>
      <tbody id="girl-rows">
        {% for girl in ['å¤šå¤š', 'èè'] %}
        <tr>
          <td>
            <input type="text" class="girl-name" value="{{ girl }}" placeholder="åç¨±">
            <input type="text" class="room-input" placeholder="æˆ¿è™Ÿ">
          </td>
          <td>
            <label><input type="checkbox" class="lang-check" value="zh">ä¸­</label>
            <label><input type="checkbox" class="lang-check" value="en">è‹±</label>
          </td>
          <td>
            <select class="nation-select" style="width:90px;">
              <option value="tw">ğŸ‡¹ğŸ‡¼å°ç£</option>
              <option value="vn">ğŸ‡»ğŸ‡³è¶Šå—</option>
              <option value="th">ğŸ‡¹ğŸ‡­æ³°åœ‹</option>
              <option value="id">ğŸ‡®ğŸ‡©å°å°¼</option>
            </select>
          </td>
          <td>
            <div class="time-row">
              {% set timeslots = [11,12,1,2,3,4,5,6,7,8,9,10,11,12,1] %}
              {% for t in timeslots %}
              <div class="time-cell">
                <label><input type="checkbox" class="hour-check" data-hour="{{ t }}" data-half="0">âœ…{{ "%02d00"|format(t) }}</label>
                <label><input type="checkbox" class="half-check" data-hour="{{ t }}" data-half="1">âœ…30</label>
              </div>
              {% endfor %}
            </div>
            <div class="duration-row">
              {% for t in timeslots %}
              <select class="duration" style="width:50px;">
                <option value="">--</option>
                <option value="40">40</option>
                <option value="60">60</option>
                <option value="90">90</option>
              </select>
              {% endfor %}
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <button class="add-girl-btn" onclick="addGirlRow()" style="margin-top:12px;">æ–°å¢å¦¹å¦¹</button>
  </div>

  <div style="flex:1;">
    <h3>å³æ™‚æ’ç­çµæœ</h3>
    <div id="output-area" style="background:#f7f9fe;border-radius:8px;min-height:400px;padding:16px;font-size:16px;white-space:pre-line;"></div>
  </div>
</div>

<script>
function addGirlRow() {
  const tbody = document.getElementById('girl-rows');
  const tr = document.createElement('tr');
  const timeslots = [11,12,1,2,3,4,5,6,7,8,9,10,11,12,1];
  let html = `
    <td>
      <input type="text" class="girl-name" placeholder="åç¨±">
      <input type="text" class="room-input" placeholder="æˆ¿è™Ÿ">
    </td>
    <td>
      <label><input type="checkbox" class="lang-check" value="zh">ä¸­</label>
      <label><input type="checkbox" class="lang-check" value="en">è‹±</label>
    </td>
    <td>
      <select class="nation-select" style="width:90px;">
        <option value="tw">ğŸ‡¹ğŸ‡¼å°ç£</option>
        <option value="vn">ğŸ‡»ğŸ‡³è¶Šå—</option>
        <option value="th">ğŸ‡¹ğŸ‡­æ³°åœ‹</option>
        <option value="id">ğŸ‡®ğŸ‡©å°å°¼</option>
      </select>
    </td>
    <td>
      <div class="time-row">`;
  for (let t of timeslots) {
    const hh = String(t).padStart(2, '0') + '00';
    html += `
      <div class="time-cell">
        <label><input type="checkbox" class="hour-check" data-hour="${t}" data-half="0">âœ…${hh}</label>
        <label><input type="checkbox" class="half-check" data-hour="${t}" data-half="1">âœ…30</label>
      </div>`;
  }
  html += `</div><div class="duration-row">`;
  for (let t of timeslots) {
    html += `
      <select class="duration" style="width:50px;">
        <option value="">--</option>
        <option value="40">40</option>
        <option value="60">60</option>
        <option value="90">90</option>
      </select>`;
  }
  html += `</div></td>`;
  tr.innerHTML = html;
  tbody.appendChild(tr);
  getScheduleResult();
}

function getNationInfo(nation, langs) {
  let emoji = '', lang = '';
  if (nation === 'tw') emoji = 'ğŸ‡¹ğŸ‡¼';
  if (nation === 'vn') emoji = 'ğŸ‡»ğŸ‡³';
  if (nation === 'th') emoji = 'ğŸ‡¹ğŸ‡­';
  if (nation === 'id') emoji = 'ğŸ‡®ğŸ‡©';

  if (langs.includes('zh') && nation === 'vn') lang = 'ä¸­è¶Šæ–‡æºé€š';
  else if (langs.includes('zh') && nation === 'th') lang = 'ä¸­æ³°æ–‡æºé€š';
  else if (langs.includes('zh') && nation === 'tw') lang = 'ä¸­æ–‡æºé€š';
  else if (langs.includes('en') && nation === 'vn') lang = 'è‹±è¶Šæ–‡æºé€š';
  else if (langs.includes('en') && nation === 'th') lang = 'è‹±æ³°æ–‡æºé€š';
  else if (nation === 'vn') lang = 'è¶Šæ–‡æºé€š';
  else if (nation === 'th') lang = 'æ³°æ–‡æºé€š';
  else if (nation === 'id') lang = 'å°å°¼æ–‡æºé€š';
  else lang = '';

  return { emoji, lang };
}

function getScheduleResult() {
  const tbody = document.getElementById('girl-rows');
  const timeslots = [11,12,1,2,3,4,5,6,7,8,9,10,11,12,1];
  let result = '';

  for (const tr of tbody.children) {
    const name = tr.querySelector('.girl-name').value.trim();
    const room = tr.querySelector('.room-input').value.trim();
    const langChecks = tr.querySelectorAll('.lang-check');
    const langs = Array.from(langChecks).filter(c => c.checked).map(c => c.value);
    const nation = tr.querySelector('.nation-select').value;
    const nationInfo = getNationInfo(nation, langs);
    if (!name) continue;

    let line = `ğŸ’—${name} ${nationInfo.emoji} ${nationInfo.lang}${room ? ' ('+room+')' : ''}`;
    let slots = [];
    const hourChecks = tr.querySelectorAll('.hour-check');
    const halfChecks = tr.querySelectorAll('.half-check');
    const durations = tr.querySelectorAll('.duration');

    for (let i = 0; i < timeslots.length; i++) {
      const h = String(timeslots[i]).padStart(2, '0');
      const full = hourChecks[i].checked;
      const half = halfChecks[i].checked;
      const dur = durations[i].value;
      if (dur && (full || half)) {
        const label = (full ? `${h}:00` : '') + (half ? (full ? ' & ' : '') + `${h}:30` : '');
        slots.push(`${label} / ${dur}åˆ†`);
      }
    }

    if (slots.length) {
      line += '\n' + slots.join('\n');
      result += line + '\n\n';
    }
  }

  document.getElementById('output-area').innerText = result.trim();
}

document.getElementById('schedule-table').addEventListener('input', getScheduleResult);
document.getElementById('schedule-table').addEventListener('change', getScheduleResult);
</script>
{% endblock %}