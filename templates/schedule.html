{% extends 'admin_custom_master.html' %}
{% block body %}
<style>
.schedule-table { border-collapse: collapse; width:100%; }
.schedule-table th, .schedule-table td { border:1px solid #b6d6ff; padding:8px 10px; text-align:center; }
.schedule-table th { background:#e3f2fd; }
.add-girl-btn { margin-top:12px; }
.nation-select { width:90px; }
.room-input { width:60px; }
.lang-check { margin:0 4px; }
.time-cell { min-width:60px; }
.time-row { display:flex; justify-content:center; gap:8px; margin-bottom:4px; }
</style>
<div class="schedule-main" style="display:flex;gap:32px;padding:32px 0;">
  <div style="flex:1;min-width:320px;">
    <h3>排班表</h3>
    <table class="schedule-table" id="schedule-table">
      <thead>
        <tr>
          <th>妹妹</th>
          <th>語言</th>
          <th>國籍</th>
          <th>房間號碼</th>
          <th colspan="16">時間</th>
        </tr>
      </thead>
      <tbody id="girl-rows">
        <tr>
          <td><input type="text" value="多多" class="girl-name" style="width:80px;"></td>
          <td>
            <label><input type="checkbox" class="lang-check" value="zh">中</label>
            <label><input type="checkbox" class="lang-check" value="en">英</label>
          </td>
          <td>
            <select class="nation-select">
              <option value="tw">🇹🇼台灣</option>
              <option value="vn">🇻🇳越南</option>
              <option value="th">🇹🇭泰國</option>
              <option value="id">🇮🇩印尼</option>
            </select>
          </td>
          <td><input type="text" class="room-input" value="501007"></td>
          <td colspan="16">
            <div class="time-row">
              {% set hours1 = [11,12,13,14,15,16,17,18] %}
              {% for hour in hours1 %}
                <span class="time-cell">
                  <input type="checkbox" class="hour-check" data-hour="{{ hour }}">
                  <label>{{ '%02d' % hour }}</label><br>
                  <select class="duration" style="width:50px;">
                    <option value="">--</option>
                    <option value="60">60</option>
                    <option value="90">90</option>
                  </select>
                </span>
              {% endfor %}
            </div>
            <div class="time-row">
              {% set hours2 = [19,20,21,22,23,24,1,2] %}
              {% for hour in hours2 %}
                <span class="time-cell">
                  <input type="checkbox" class="hour-check" data-hour="{{ hour }}">
                  <label>{{ '%02d' % hour }}</label><br>
                  <select class="duration" style="width:50px;">
                    <option value="">--</option>
                    <option value="60">60</option>
                    <option value="90">90</option>
                  </select>
                </span>
              {% endfor %}
            </div>
          </td>
        </tr>
        <tr>
          <td><input type="text" value="莎莎" class="girl-name" style="width:80px;"></td>
          <td>
            <label><input type="checkbox" class="lang-check" value="zh">中</label>
            <label><input type="checkbox" class="lang-check" value="en">英</label>
          </td>
          <td>
            <select class="nation-select">
              <option value="tw">🇹🇼台灣</option>
              <option value="vn">🇻🇳越南</option>
              <option value="th">🇹🇭泰國</option>
              <option value="id">🇮🇩印尼</option>
            </select>
          </td>
          <td><input type="text" class="room-input" value=""></td>
          <td colspan="16">
            <div class="time-row">
              {% set hours1 = [11,12,13,14,15,16,17,18] %}
              {% for hour in hours1 %}
                <span class="time-cell">
                  <input type="checkbox" class="hour-check" data-hour="{{ hour }}">
                  <label>{{ '%02d' % hour }}</label><br>
                  <select class="duration" style="width:50px;">
                    <option value="">--</option>
                    <option value="60">60</option>
                    <option value="90">90</option>
                  </select>
                </span>
              {% endfor %}
            </div>
            <div class="time-row">
              {% set hours2 = [19,20,21,22,23,24,1,2] %}
              {% for hour in hours2 %}
                <span class="time-cell">
                  <input type="checkbox" class="hour-check" data-hour="{{ hour }}">
                  <label>{{ '%02d' % hour }}</label><br>
                  <select class="duration" style="width:50px;">
                    <option value="">--</option>
                    <option value="60">60</option>
                    <option value="90">90</option>
                  </select>
                </span>
              {% endfor %}
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <button class="add-girl-btn" onclick="addGirlRow()">新增妹妹</button>
  </div>
  <div style="flex:1;min-width:320px;">
    <h3>即時排班結果</h3>
    <div id="output-area" style="background:#f7f9fe;border-radius:8px;min-height:400px;padding:16px;font-size:16px;white-space:pre-line;"></div>
  </div>
</div>
<script>
function addGirlRow() {
  const tbody = document.getElementById('girl-rows');
  const tr = document.createElement('tr');
  let html = '<td><input type="text" value="" class="girl-name" style="width:80px;"></td>';
  html += `<td><label><input type='checkbox' class='lang-check' value='zh'>中</label><label><input type='checkbox' class='lang-check' value='en'>英</label></td>`;
  html += `<td><select class='nation-select'><option value='tw'>🇹🇼台灣</option><option value='vn'>🇻🇳越南</option><option value='th'>🇹🇭泰國</option><option value='id'>🇮🇩印尼</option></select></td>`;
  html += `<td><input type='text' class='room-input'></td>`;
  html += `<td colspan='16'><div class='time-row'>`;
  const hours1 = [11,12,13,14,15,16,17,18];
  for(let h of hours1) {
    html += `<span class='time-cell'><input type='checkbox' class='hour-check' data-hour='${h}'><label>${('0'+h).slice(-2)}</label><br><select class='duration' style='width:50px;'><option value=''>--</option><option value='60'>60</option><option value='90'>90</option></select></span>`;
  }
  html += `</div><div class='time-row'>`;
  const hours2 = [19,20,21,22,23,24,1,2];
  for(let h of hours2) {
    html += `<span class='time-cell'><input type='checkbox' class='hour-check' data-hour='${h}'><label>${('0'+h).slice(-2)}</label><br><select class='duration' style='width:50px;'><option value=''>--</option><option value='60'>60</option><option value='90'>90</option></select></span>`;
  }
  html += `</div></td>`;
  tr.innerHTML = html;
  tbody.appendChild(tr);
}
function getNationInfo(nation, langs) {
  let emoji = '';
  let lang = '';
  if(nation === 'tw') emoji = '🇹🇼';
  if(nation === 'vn') emoji = '🇻🇳';
  if(nation === 'th') emoji = '🇹🇭';
  if(nation === 'id') emoji = '🇮🇩';
  // 語言規則
  if(langs.includes('zh') && nation === 'vn') lang = '中越文溝通';
  else if(langs.includes('zh') && nation === 'th') lang = '中泰文溝通';
  else if(langs.includes('zh') && nation === 'tw') lang = '中文溝通';
  else if(langs.includes('en') && nation === 'vn') lang = '英越文溝通';
  else if(langs.includes('en') && nation === 'th') lang = '英泰文溝通';
  else if(nation === 'vn') lang = '越文溝通';
  else if(nation === 'th') lang = '泰文溝通';
  else if(nation === 'id') lang = '印尼文溝通';
  else lang = '';
  return {emoji, lang};
}
function getScheduleResult() {
  const tbody = document.getElementById('girl-rows');
  const hours = [11,12,13,14,15,16,17,18,19,20,21,22,23,24,1,2];
  let result = '';
  for(const tr of tbody.children) {
    const name = tr.querySelector('.girl-name').value.trim();
    const langChecks = tr.querySelectorAll('.lang-check');
    const langs = Array.from(langChecks).filter(c=>c.checked).map(c=>c.value);
    const nationSelect = tr.querySelector('.nation-select');
    const nation = nationSelect.value;
    const room = tr.querySelector('.room-input').value.trim();
    if(!name) continue;
    const nationInfo = getNationInfo(nation, langs);
    let line = `💗${name} 11:00-01:00${nationInfo.emoji ? ' ' + nationInfo.emoji : ''}➡️${nationInfo.lang ? nationInfo.lang : ''}${room ? ' ('+room+')' : ''}`;
    let slots = [];
    const hourCells = tr.querySelectorAll('.time-cell');
    for(let i=0;i<hourCells.length;i++) {
      const checked = hourCells[i].querySelector('.hour-check').checked;
      const duration = hourCells[i].querySelector('.duration').value;
      if(checked && duration) {
        slots.push(`${hours[i]<10 ? '0'+hours[i] : hours[i]}:00/${duration}`);
      }
    }
    if(slots.length) {
      line += '\n' + slots.join('\n');
      result += line + '\n\n';
    }
  }
  document.getElementById('output-area').innerText = result.trim();
}
document.getElementById('schedule-table').addEventListener('input', getScheduleResult);
document.getElementById('schedule-table').addEventListener('change', getScheduleResult);
</script>
{% endblock %}
