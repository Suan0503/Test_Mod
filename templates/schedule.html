{% extends 'admin_custom_master.html' %}
{% block body %}
<style>
.schedule-table { border-collapse: collapse; width:100%; }
.schedule-table th, .schedule-table td { border:1px solid #b6d6ff; padding:6px 8px; text-align:center; }
.schedule-table th { background:#e3f2fd; }
.add-girl-btn { margin-top:12px; }
.nation-select { width:90px; }
.room-input { width:60px; }
</style>
<div class="schedule-main" style="display:flex;gap:32px;padding:32px 0;">
  <div style="flex:1;min-width:320px;">
    <h3>æ’ç­è¡¨</h3>
    <table class="schedule-table" id="schedule-table">
      <thead>
        <tr>
          <th>å¦¹å¦¹</th>
          <th>åœ‹ç±</th>
          <th>æˆ¿é–“è™Ÿç¢¼</th>
          {% for hour in range(13, 19) %}
            <th>{{ hour }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody id="girl-rows">
        <tr>
          <td><input type="text" value="å¤šå¤š" class="girl-name" style="width:80px;"></td>
          <td>
            <select class="nation-select" multiple>
              <option value="tw">ğŸ‡¹ğŸ‡¼å°ç£</option>
              <option value="vn">ğŸ‡»ğŸ‡³è¶Šå—</option>
              <option value="th">ğŸ‡¹ğŸ‡­æ³°åœ‹</option>
              <option value="en">ğŸ‡¬ğŸ‡§è‹±æ–‡</option>
              <option value="id">ğŸ‡®ğŸ‡©å°å°¼</option>
            </select>
          </td>
          <td><input type="text" class="room-input" value="501007"></td>
          {% for hour in range(13, 19) %}
          <td>
            <input type="checkbox" class="hour-check">
            <select class="duration" style="width:50px;">
              <option value="">--</option>
              <option value="60">60</option>
              <option value="90">90</option>
            </select>
          </td>
          {% endfor %}
        </tr>
        <tr>
          <td><input type="text" value="èè" class="girl-name" style="width:80px;"></td>
          <td>
            <select class="nation-select" multiple>
              <option value="tw">ğŸ‡¹ğŸ‡¼å°ç£</option>
              <option value="vn">ğŸ‡»ğŸ‡³è¶Šå—</option>
              <option value="th">ğŸ‡¹ğŸ‡­æ³°åœ‹</option>
              <option value="en">ğŸ‡¬ğŸ‡§è‹±æ–‡</option>
              <option value="id">ğŸ‡®ğŸ‡©å°å°¼</option>
            </select>
          </td>
          <td><input type="text" class="room-input" value=""></td>
          {% for hour in range(13, 19) %}
          <td>
            <input type="checkbox" class="hour-check">
            <select class="duration" style="width:50px;">
              <option value="">--</option>
              <option value="60">60</option>
              <option value="90">90</option>
            </select>
          </td>
          {% endfor %}
        </tr>
      </tbody>
    </table>
    <button class="add-girl-btn" onclick="addGirlRow()">æ–°å¢å¦¹å¦¹</button>
  </div>
  <div style="flex:1;min-width:320px;">
    <h3>å³æ™‚æ’ç­çµæœ</h3>
    <div id="output-area" style="background:#f7f9fe;border-radius:8px;min-height:400px;padding:16px;font-size:16px;white-space:pre-line;"></div>
  </div>
</div>
<script>
function addGirlRow() {
  const tbody = document.getElementById('girl-rows');
  const tr = document.createElement('tr');
  let html = '<td><input type="text" value="" class="girl-name" style="width:80px;"></td>';
  html += `<td><select class='nation-select' multiple><option value='tw'>ğŸ‡¹ğŸ‡¼å°ç£</option><option value='vn'>ğŸ‡»ğŸ‡³è¶Šå—</option><option value='th'>ğŸ‡¹ğŸ‡­æ³°åœ‹</option><option value='en'>ğŸ‡¬ğŸ‡§è‹±æ–‡</option><option value='id'>ğŸ‡®ğŸ‡©å°å°¼</option></select></td>`;
  html += `<td><input type='text' class='room-input'></td>`;
  for(let i=0;i<6;i++) {
    html += `<td><input type="checkbox" class="hour-check"><select class="duration" style="width:50px;"><option value="">--</option><option value="60">60</option><option value="90">90</option></select></td>`;
  }
  tr.innerHTML = html;
  tbody.appendChild(tr);
}
function getNationInfo(select) {
  const selected = Array.from(select.selectedOptions).map(o=>o.value);
  let emoji = '';
  let lang = '';
  if(selected.includes('tw') && selected.includes('vn')) { emoji = 'ğŸ‡¹ğŸ‡¼ğŸ‡»ğŸ‡³'; lang = 'ä¸­è¶Šæ–‡æºé€š'; }
  else if(selected.includes('tw')) { emoji = 'ğŸ‡¹ğŸ‡¼'; lang = 'ä¸­æ–‡æºé€š'; }
  else if(selected.includes('vn')) { emoji = 'ğŸ‡»ğŸ‡³'; lang = 'è¶Šæ–‡æºé€š'; }
  else if(selected.includes('th') && selected.includes('en')) { emoji = 'ğŸ‡¹ğŸ‡­ğŸ‡¬ğŸ‡§'; lang = 'è‹±æ–‡æºé€š'; }
  else if(selected.includes('th')) { emoji = 'ğŸ‡¹ğŸ‡­'; lang = 'æ³°æ–‡æºé€š'; }
  else if(selected.includes('en')) { emoji = 'ğŸ‡¬ğŸ‡§'; lang = 'è‹±æ–‡æºé€š'; }
  else if(selected.includes('id')) { emoji = 'ğŸ‡®ğŸ‡©'; lang = 'å°å°¼æ–‡æºé€š'; }
  else { emoji = ''; lang = ''; }
  return {emoji, lang};
}
function getScheduleResult() {
  const tbody = document.getElementById('girl-rows');
  const hours = [13,14,15,16,17,18];
  let result = '';
  for(const tr of tbody.children) {
    const name = tr.querySelector('.girl-name').value.trim();
    const nationSelect = tr.querySelector('.nation-select');
    const room = tr.querySelector('.room-input').value.trim();
    if(!name) continue;
    const nation = getNationInfo(nationSelect);
    let line = `ğŸ’—${name} 11:00-01:00${nation.emoji ? ' ' + nation.emoji : ''}â¡ï¸${nation.lang ? nation.lang : ''}${room ? ' ('+room+')' : ''}`;
    let slots = [];
    const tds = tr.querySelectorAll('td');
    for(let i=3;i<tds.length;i++) {
      const checked = tds[i].querySelector('.hour-check').checked;
      const duration = tds[i].querySelector('.duration').value;
      if(checked && duration) {
        slots.push(`${hours[i-3]}:00/${duration}`);
      }
    }
    if(slots.length) {
      line += '\n' + slots.join('\n');
      result += line + '\n\n';
    }
  }
  document.getElementById('output-area').innerText = result.trim();
}
document.getElementById('schedule-table').addEventListener('input', getScheduleResult);
document.getElementById('schedule-table').addEventListener('change', getScheduleResult);
</script>
{% endblock %}
