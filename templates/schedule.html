{% extends 'admin_custom_master.html' %}
{% block body %}
<style>
  .schedule-table { border-collapse: collapse; width:100%; }
  .schedule-table th, .schedule-table td { border:1px solid #b6d6ff; padding:8px; text-align:center; }
  .schedule-table th { background:#e3f2fd; }
  .girl-name, .room-input { width:80px; display:block; margin:2px auto; }
  .lang-check { margin:0 4px; }
  .time-entry { display:flex; align-items:center; gap:6px; margin-bottom:4px; }
  .time-entry select, .time-entry input { width:80px; }
  .time-control { margin-top:6px; text-align:center; }
</style>

<div class="schedule-main" style="display:flex;gap:32px;padding:32px 0;">
  <div style="flex:1;">
    <h3>æ’ç­è¡¨</h3>
    <table class="schedule-table" id="schedule-table">
      <thead>
        <tr>
          <th>å¦¹å¦¹<br><small>ï¼ˆåç¨±ï¼‹æˆ¿è™Ÿï¼‰</small></th>
          <th>èªè¨€</th>
          <th>åœ‹ç±</th>
          <th>æ™‚é–“</th>
        </tr>
      </thead>
      <tbody id="girl-rows">
        <tr>
          <td>
            <input type="text" class="girl-name" value="å¤šå¤š" placeholder="åç¨±">
            <input type="text" class="room-input" placeholder="æˆ¿è™Ÿ">
          </td>
          <td>
            <label><input type="checkbox" class="lang-check" value="zh">ä¸­</label>
            <label><input type="checkbox" class="lang-check" value="en">è‹±</label>
          </td>
          <td>
            <select class="nation-select" style="width:90px;">
              <option value="tw">ğŸ‡¹ğŸ‡¼ å°ç£</option>
              <option value="vn">ğŸ‡»ğŸ‡³ è¶Šå—</option>
              <option value="th">ğŸ‡¹ğŸ‡­ æ³°åœ‹</option>
              <option value="id">ğŸ‡®ğŸ‡© å°å°¼</option>
            </select>
          </td>
          <td>
            <div class="time-slot-list"></div>
            <div class="time-control">
              <button type="button" onclick="addTimeSlot(this)">ï¼‹æ–°å¢æ™‚é–“</button>
              <button type="button" onclick="sortTimeSlots(this)">ğŸ”„åˆ·æ–°æ’åº</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div style="flex:1;">
    <h3>å³æ™‚æ’ç­çµæœ</h3>
    <div id="output-area" style="background:#f7f9fe;border-radius:8px;min-height:400px;padding:16px;font-size:16px;white-space:pre-line;"></div>
  </div>
</div>

<script>
function addTimeSlot(btn) {
  const list = btn.closest('td').querySelector('.time-slot-list');
  const wrapper = document.createElement('div');
  wrapper.className = 'time-entry';
  wrapper.innerHTML = `
    <input type="number" class="time-value" min="0" max="2359" placeholder="æ™‚é–“ (e.g. 1200)">
    <select class="duration">
      <option value="">--</option>
      <option value="40">40</option>
      <option value="60">60</option>
      <option value="90">90</option>
    </select>
    <button onclick="this.parentElement.remove()">åˆªé™¤</button>
  `;
  list.appendChild(wrapper);
  getScheduleResult();
}

function sortTimeSlots(btn) {
  const list = btn.closest('td').querySelector('.time-slot-list');
  const entries = Array.from(list.querySelectorAll('.time-entry'));
  entries.sort((a, b) => {
    const ta = parseInt(a.querySelector('.time-value').value || 0);
    const tb = parseInt(b.querySelector('.time-value').value || 0);
    return ta - tb;
  });
  entries.forEach(e => list.appendChild(e));
  getScheduleResult();
}

function getScheduleResult() {
  const tbody = document.getElementById('girl-rows');
  let result = '';
  for (const tr of tbody.children) {
    const name = tr.querySelector('.girl-name').value.trim();
    const room = tr.querySelector('.room-input').value.trim();
    const langs = Array.from(tr.querySelectorAll('.lang-check')).filter(c => c.checked).map(c => c.value);
    const nation = tr.querySelector('.nation-select').value;
    if (!name) continue;

    let line = `ğŸ’—${name} ${nationText(nation)} ${langText(nation, langs)}${room ? ' ('+room+')' : ''}`;
    let slots = [];
    tr.querySelectorAll('.time-entry').forEach(entry => {
      const time = entry.querySelector('.time-value').value;
      const dur = entry.querySelector('.duration').value;
      if (time && dur) slots.push(`${time} / ${dur}åˆ†`);
    });
    if (slots.length) line += '\n' + slots.join('\n');
    result += line + '\n\n';
  }
  document.getElementById('output-area').innerText = result.trim();
}

function nationText(n) {
  return n === 'tw' ? 'ğŸ‡¹ğŸ‡¼' : n === 'vn' ? 'ğŸ‡»ğŸ‡³' : n === 'th' ? 'ğŸ‡¹ğŸ‡­' : 'ğŸ‡®ğŸ‡©';
}

function langText(nation, langs) {
  if (langs.includes('zh') && nation === 'vn') return 'ä¸­è¶Šæ–‡æºé€š';
  if (langs.includes('zh') && nation === 'th') return 'ä¸­æ³°æ–‡æºé€š';
  if (langs.includes('zh') && nation === 'tw') return 'ä¸­æ–‡æºé€š';
  if (langs.includes('en') && nation === 'vn') return 'è‹±è¶Šæ–‡æºé€š';
  if (langs.includes('en') && nation === 'th') return 'è‹±æ³°æ–‡æºé€š';
  if (nation === 'vn') return 'è¶Šæ–‡æºé€š';
  if (nation === 'th') return 'æ³°æ–‡æºé€š';
  if (nation === 'id') return 'å°å°¼æ–‡æºé€š';
  return '';
}

document.getElementById('schedule-table').addEventListener('input', getScheduleResult);
document.getElementById('schedule-table').addEventListener('change', getScheduleResult);
</script>
{% endblock %}
