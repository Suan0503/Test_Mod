<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>名單管理</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body class="bg-light">
    <div class="container py-4">
      <h1 class="mb-3">白名單 / 黑名單 管理</h1>

      <form class="row g-2 mb-3" method="get" action="{{ url_for('list_admin.index') }}">
        <div class="col-auto">
          <input type="text" class="form-control" name="q" placeholder="搜尋 identifier / name / phone / email" value="{{ q }}">
        </div>
        <div class="col-auto">
          <button class="btn btn-primary">搜尋</button>
        </div>
        <div class="col-auto">
          <a class="btn btn-success" href="{{ url_for('list_admin.new_whitelist_form') }}">新增白名單</a>
          <a class="btn btn-danger" href="{{ url_for('list_admin.new_blacklist_form') }}">新增黑名單</a>
        </div>
      </form>

      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for cat, msg in messages %}
            <div class="alert alert-{{ 'info' if cat=='info' else ('danger' if cat=='danger' else ('warning' if cat=='warning' else 'success')) }}">{{ msg }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <div class="row">
        <div class="col-md-6">
          <h3>白名單 (最新 200)</h3>
          <table class="table table-sm table-bordered bg-white">
            <thead>
              <tr>
                <th>identifier</th><th>name</th><th>contact</th><th>note</th><th>動作</th>
              </tr>
            </thead>
            <tbody>
              {% for w in whitelists %}
              <tr>
                <!-- 使用 phone 取代原本不存在的 identifier -->
                <td>{{ w.phone }}</td>
                <td>{{ w.name }}</td>
                <!-- 顯示 phone 與 line_user_id（若沒有 line_user_id 則顯示空白） -->
                <td>{{ w.phone }}{% if w.line_user_id %}<br/>{{ w.line_user_id }}{% endif %}</td>
                <!-- model 有 reason 欄位，改用 reason 顯示備註/說明 -->
                <td>{{ w.reason }}</td>
                <td>
                  <a class="btn btn-sm btn-outline-primary" href="{{ url_for('list_admin.edit_whitelist', id=w.id) }}">編輯</a>
                  <form method="post" action="{{ url_for('list_admin.delete_whitelist', id=w.id) }}" style="display:inline" onsubmit="return confirm('確定刪除？');">
                    <button type="submit" class="btn btn-sm btn-outline-danger">刪除</button>
                  </form>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="col-md-6">
          <h3>黑名單 (最新 200)</h3>
          <table class="table table-sm table-bordered bg-white">
            <thead>
              <tr>
                <th>identifier</th><th>name</th><th>contact</th><th>reason</th><th>動作</th>
              </tr>
            </thead>
            <tbody>
              {% for b in blacklists %}
              <tr>
                <!-- 同樣使用 phone 取代 identifier -->
                <td>{{ b.phone }}</td>
                <td>{{ b.name }}</td>
                <!-- 顯示 phone 與（若有）line_user_id -->
                <td>{{ b.phone }}{% if b.line_user_id %}<br/>{{ b.line_user_id }}{% endif %}</td>
                <td>{{ b.reason }}</td>
                <td>
                  <a class="btn btn-sm btn-outline-primary" href="{{ url_for('list_admin.edit_blacklist', id=b.id) }}">編輯</a>
                  <form method="post" action="{{ url_for('list_admin.delete_blacklist', id=b.id) }}" style="display:inline" onsubmit="return confirm('確定刪除？');">
                    <button type="submit" class="btn btn-sm btn-outline-danger">刪除</button>
                  </form>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      </div>
    </div>
  </body>
</html>
